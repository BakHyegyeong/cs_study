# 문맥 교환(Context Switching)이란?
- 현재 실행되고 있는 프로세스의 상태를 PCB로 보관하고 새로운 프로세스가 CPU를 사용할 수 있도록 해당 프로세스의 PCB를 읽어서 해당 프로세스를 적재하는 작업
- 종류는 프로세스 컨텍스트 스위칭과 스레드 컨텐스트 스위칭이 있음
### 목적
- 여러 프로세스와 스레드들이 동시에 실행되는 것처럼 보이기 위함
- 여러 프로세스와 스레드들이 공정하게 CPU를 통헤 처리하기 위함
- 높은 우선순위의 작업을 빠르게 처리할 수 있도록 함

### 발생 시점
- 프로세스나 스레드에 할당된 시간을 다 사용해서 인터럽트가 발생한 경우.
- I/O작업이나 추가 리소스처럼 다른 작업을 먼저 실행해야할 때 (프로세스 상태: 실행 -> 대기)
###### 인터럽트 : 프로세스 실행 중에 예기치 않은 상황이 발생한 경우, 처리한 후 실행 중인 작업으로 복귀함

### 프로세스 컨텍스트 스위칭 vs 스레드 컨텍스트 스위칭
- 공통점
  - 각종 자원 관리를 맡고있는 운영체제의 핵심인 **커널**에서 컨텍스트 스위칭이 진행됨
  - 이전 CPU의 레지스터 상태를 저장하고 새로운 프로세스/스레드 상태에 따라 실행함.(어디까지 실행되었는지 상태를 알고있어야 다시 이어서 실행할 수 있으므로 레지스터 상태를 저장함)
- 차이점
  - 스레드 컨텍스트 스위칭
      - 같은 프로세스의 스레드들은 스택 이외의 메모리 영역(data, heap, code)을 공유한다. 그러므로 스위칭이 일어나도 메모리에 대해 신경쓰지 않아도 됨
  - 프로세스 컨텍스트 스위칭
      - 프로세스 간의 메모리 구조체계가 다르기 때문에, MMU도 새로운 프로세스의 체계를 바라볼 수 있게 해야하고,  TLB도 이전의 체계를 갖고 있으므로, 완전히 비워줘야한다.
  - 위와 같은 가상 메모리 주소 처리 관련 추가 작업으로 인하여 스레스 컨텍스트 스위칭이 더 빠름.
###### 레지스터 : CPU에서 각종 명령어들을 수행하기 위해 필요한 여러 데이터들을 저장하는 곳
###### MMU : 가상 메모리와 물리 메모리 사이의 주소 변환을 담당
###### TLB : MMU 내에 존재하는 캐시 메모리로, 가상 주소를 실제 물리 주소로 변환한 결과를 TLB에 저장해 두고 빠르게 사용할 수 있도록 캐싱.

### 무자비한 프로세스 컨텍스트 스위칭은 지양해야 한다?
CPU가 자주 쓰는 정보를 캐시를 해두는데, 프로세스 컨텍스트 스위칭이 잦으면 캐시를 할 이유가 없어짐.(결국 매번 메인 메모리를 읽어와야해서 처리속도 저하)
