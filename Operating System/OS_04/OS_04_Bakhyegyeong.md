# 문맥 교환(Context Switching)이란?


: **CPU에서 실행 중이던 프로세스가 다른 프로세스로 교체되는 것**으로 PCB를 기반으로 프로세스의 상태를 저장하고 불러온다.

### Context Switching이 필요한 이유

- 여러 프로세스와 스레드들을 **동시에 실행시키는 것처럼 보이게** 하기 위해
- 여러 프로세스와 스레드들이 **공정하게 CPU 시간을 나눠 갖게** 하기 위해
- **높은 우선순위의 작업이 빠르게** 처리될 수 있게

### Context Switching이 발생하는 때

- **멀티태스킹** : 실행 가능한 프로세스들이 운영체제의 스케줄러에 의해 조금씩 번갈아가며 수행되는 것
- **인터럽트 핸들링** : 인터럽트가 발생
    - I/O request : 입출력 요청
    - time slice expired : CPU 사용시간이 만료
    - fork a child : 자식 프로세스 생성
    - wait for an interrupt : 인터럽트 처리 대기
- 사용자 모드와 커널 모드간의 전환

### Context Switching 과정

![image.png](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcLs4ee%2Fbtq6zCgeEaS%2FeMkhgp9failtca7VYSgbkk%2Fimg.png)

1. 요청 발생 : 인터럽트 또는 시스템 콜 발생
2. PCB에 저장 : 운영체제는 현재 실행중인 프로세스의 정보를 PCB에 저장한다.
3. CPU 할당 : 운영체제는 다음 프로세스의 정보를 PCB에서 가져와 CPU를 할당한다.

### Context Switching의 문제점

1. **오버헤드** : 잦은 Context Switching은 오버헤드로 성능 저하를 발생시킨다.
    
    → 유휴 시간 (Idle Time) : Context Switching시 CPU가 아무런 작업을 하지 못하는 시간
    
2. **캐시 미스** : 캐시 메모리에 이전에 프로세스에서 실행되었던 정보들이 저장되어 있기 때문에 캐시 클리어 과정을 겪게 되는데 이 과정에서 캐시 미스가 발생한다.
    
    > 💡 캐시 메모리 : 메인 메모리에 비해 매우 작은 크기를 가지며 프로세스끼리 공유하는 공간이다.
    
    

### 프로세스간의 스위칭과 프로세스 안의 스레드들간의 스위칭

- 공통점
    - 커널 모드에서 실행된다.
    - CPU의 레지스터 상태를 교체한다.
- 차이점
    - 스레드들간의 스위칭은 스택을 제외한 코드, 데이터, 힙 영역을 공유하기 때문에 비용이 더 적고 시간도 더 적게 걸린다.
    - 프로세스간의 스위칭은 메모리 주소 관련된 처리를 추가로 수행해야 한다.
        - MMU : 가상 메모리와 물리 메모리 사이의 주소 변환
        - TLB : MMU 내에 존재하는 캐시 메모리
        
        → MMU가 실행 될 작업의 메모리를 보도록 해야 하고 캐시 역할을 하는 TLB를 비워야 한다.