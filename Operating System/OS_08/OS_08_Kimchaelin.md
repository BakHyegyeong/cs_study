# 가상 메모리의 개념 및 장점
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Virtual_memory.svg/1280px-Virtual_memory.svg.png">

- 가상메모리는 실제 물리 메모리보다 더 큰 프로세스나 여러 작업을 실행시켜 더 메모리가 많아 보이게 하는 기술
- 프로세스가 실행될 때 메모리에 해당 프로세스 전체가 올라가지 않더라도 실행이 가능하다는 점에서 나온 메모리 기법

#### 배경
- 이전 컴퓨터에선 가장 큰 실행 애플리케이션가 필요한 메모리보다 사용 가능한 RAM의 용량이 작은 경우 "메모리 부족"으로 해당 애플리케이션을 실행할 수 없었음. 
- 프로그램이 메모리의 특정 위치를 참조할 때, 그 주변 위치를 연속해서 참조하는 경향이 있음(지역성)
- 이를 이용해서 CPU는 한 번 가져온 데이터 주변의 메모리에 미리 가져오면 빠른 접근이 가능함.
- 이러한 자역성을 이용해, 가상 메모리 방식을 통해 자주 사용되는 메모리 페이지를 물리 메모리에 유지하고, 필요 시에만 페이지 교체를 통해 접근 시간을 최소화.

#### 과정
- 프로그램의 일부분만 메모리(주 기억장치)에 올려지고, 메모리에 올라가지 않는 나머지는 보조 기억장치에 존재.
- CPU가 각 메모리에 접근하기 이전에 MMU가 메모리 주소 번환 작업(가상주소 -> 물리주소)이 수행됨.
- 메모리를 일일이 번환하게 되면 부하가 너무 높아지므로, MMU는 RAM을 여러 부분(페이지)로 나누어 각 페이지를 하나의 독립된 항목으로 처리함.
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FkTRg1%2FbtrsWKBL1Yv%2FXMO4Um3MYwDlIYPCkxS6g0%2Fimg.png">
###### 페이지 : 가상메모리를 같은 크기의 블록으로 나눈 것
###### 가상적으로 주어진 주소 - 가상 주소(virtual address) 또는 논리 주소(logical address)
###### 실제 메모리 상에서 유효한 주소 - 물리 주소(physical address)

## 장점
- 보안성 및 안정성 : 프로그램은 간접 접근하며 프로그램과 메모리 간의 분리되며 필요한 경우에만 서로 공유해 메모리 접근에 대한 오류를 줄일 수 있음
- 개발 용이성 : 실제메모리 용량과는 무관하게 프로그램을 만들수 있음
- 메모리 관리 : 운영 체제는 프로그램이 별로 사용되지 않는다고 판단되는 가상 메모리의 일부분을 압축하거나 스왑하여 실제 메모리의 공간을 확보하는 등의 관리를 할 수 있음.

## 가상 메모리 관련 주요 개념

#### TLB
- 가상 메모리 주소를 물리적 주소로 변환한 것을 변환 테이블에 저장하여, 주소 변화 속도를 높이는 캐시
- CPU가 가상 주소를 가지고 메모리에 접근할 때, 우선은 TLB에 접근하여 가상 주소에 해당되는 물리 주소를 찾고, 만약 존재하지 않으면 MMU가 페이지 테이블에서 해당되는 물리 주소로 변환한 후 메모리에 접근하게 됨.

#### 요구 페이징
CPU가 요청할 때 프로세스의 데이터를 메모리에 올리는 것을 의미함. 즉, 처음부터 모든 데이터를 메모리로 적재하지는 않음.

#### 페이지 폴트
- 어떤 프로그램이 자신의 주소 공간(가상 메모리 공간)에는 존재하지만 시스템의 실제 물리 메모리(RAM)에는 존재하지 않는 데이터에 접근을 시도할 경우 발생하는 인터럽트
- 페이지 폴트가 발생하면 운영체제는 그 데이터를 메모리로 가져와서, 해결 후 이어서 실행 (페이지 폴트가 발생하지 않은 것처럼, 프로그램이 계속 작동되게 해줌.)
- 페이지 폴트가 자주 일어나면 운영체제의 성능이 많이 저하를 일으킴.

#### 페이지 교체 전략
- 페이지 폴트를 최소화하기 위한 방법.
- 메모리가 꽉 차있을 때 기존 페이지 중 하나를 RAM에서 보조 기억 장치로 내리고, 새로운 페이지를 해당 물리 메모리 공간에 올림. 
- 기존 페이지 중 어떤 것을 내리면 좋을지에 대한 알고리즘(페이지 교체 알고리즘)
  - 종류
    - OPT(Optimal) : 앞으로 가장 오랫동안 사용되지 않을 페이지 교체
    - FIFO(First In First Out)
    -  LRU(Least Recently Used) : 가장 오랫동안 사용되지 않은 페이지 교체
    -  LFU(Least Frequently Used) : 참조 횟수가 가장 작은 페이지 교체
    -  MFU(Most Frequently used) : 참조 횟수가 가장 많은 페이지 교체
    -  NUR(Not Used Recently) : 최근에 사용하지 않은 페이지 교체
