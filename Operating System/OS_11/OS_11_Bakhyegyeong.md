# Deadlock (교착상태)

: 두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbHk2ju%2Fbtr7s3JYoPj%2FOLlYSJ7c8yxjr6910nUvsK%2Fimg.png)

## 교착 상태의 원인

1. 상호 배제 : **한번에 프로세스 하나만 해당 자원을 사용할 수 있기 때문에** 한 프로세스가 자원을 독점하고 있어 다른 프로세스들이 접근이 불가능한 상태
2. 점유 대기 : 특정 프로세스가 점유한 자원을 다른 프로세스가 요청하는 상태
3. 비선점 : 다른 프로세스의 자원을 강제적으로 가져올 수 없다.
4. 환형 대기 : 프로세스 A가 프로세스 B의 자원을 요구하고, 프로세스 B는 프로세스 A의 자원을 요구하는 등 서로가 서로의 자원을 요구하는 상황


> 💡 자원 할당 그래프 : 교착 상태 상황을 확인하기 위한 도구로 교착 상태가 왜 발생하는지 대략적으로 파악할 수 있다.


## 교착 상태의 해결 방법

1. 자원을 할당할 때 상호 배제, 점유 대기, 비선점 등의 조건이 성립되지 않도록 설계한다.
    
    → **자원의 활용률이 낮아진다**는 단점이 있다.
    
2. 교착 상태 가능성이 없을 때만 자원이 할당되며, **항시 안전 상태를 유지하며 자원을 할당하는 방식**이다.
→ 프로세스당 요청할 자원들의 최대치를 통해 자원 할당 가능 여부를 파악하는 **은행원 알고리즘**을 사용한다.
    1. 안전 순서열 : 교착 상태 없이 안전하게 모든 프로세스들에 자원을 할당할 수 있게하는 순서
    2. 안전 상태 : 교착 상태 없이 모든 프로세스가 자원을 할당받고 종료될 수 있는 상태
    3. 불안전 상태 : 교착 상태가 발생할 수도 있는 상태
3. 교착 상태가 발생하면 사이클이 있는지 찾아보고 **이에 관련된 프로세스를 한 개씩 지운다.**
    
    → 한 프로세스를 종료하고 교착 상태가 해결되었는지 확인하는 작업을 반복해야 하므로 오버헤드가 발생한다.
    
4. 교착 상태는 매우 드물게 일어나기 때문에 이를 처리하는 비용이 더 커서 **교착 상태가 발생하면 사용자의 작업을 종료**한다.
    
    → 작업 내역을 잃을 위험성이 존재한다.
    

### 은행원 알고리즘

: 총 자원의 양과 현재 할당한 자원의 양을 기준으로 안정 또는 불안정 상태로 나누고 안정 상태로 가도록 자원을 할당하는 알고리즘

| (t=t0) | Max | Allocation | Need | Available |
|--------|-----|------------|------|-----------|
| P0     | 10  | 5          | 5    |          |
| P1     | 4   | 2          | 2    |           |
| P2     | 9   | 2          | 7    |           |


- Available 자원 : 12
- 안전 순서열 : p1 → p0 → p2

1. `P1`은 2개가 이미 할당되어 있고, 2개를 추가적으로 할당받기를(`Need`) 기다리고 있습니다. 현재 **Available 자원은 3개**이므로, 이 중에 2개를 P1에게 할당해 줍니다. → **현재 Available은 3 - 2 = 1개**
2. 실행이 끝난 `P1`은 자신에게 할당되어 있던 자원 4개를 모두 반납합니다. → **현재 Available은 1 + 4 = 5개**
3. 현재 Available 자원이 5개이고, 이를 **P0에게 모두 할당해 주면** P0도 실행 가능해집니다. → **현재 Available은 5 - 5 = 0개** 가 됩니다.
4. 실행이 끝난 `P0`은 자신에게 할당되어 있던 자원 10개를 모두 반납합니다. → **현재 Available은 0 + 10 = 10개**
5. 마지막으로 `P2`에게 자원 7개를 할당해 줍니다. → **현재 Available은 10 - 7 = 3개**
6. 실행이 끝난 `P2`는 자신에게 할당되어 있던 자원 9개를 모두 반납합니다. → **현재 Available은 3 + 9 = 12개**

→ **미리 최대 자원 요구량을 알아야 하고, 할당할 수 있는 자원 수가 일정해야 하는 등 사용에 있어 제약조건이 많다.**