# 로드 밸런싱

대용량 트래픽을 장애 없이 처리하기 위해 여러 대의 서버에 적절히 트래픽을 분배 하는 것

## 로드 밸런싱 알고리즘

- Round Robin : 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식
    - 여러 대의 서버가 동일한 스펙을 가지고 있는 경우에 사용한다.
    - 서버와의 연결(세션)이 오래 지속되지 않는 경우에 활용한다.
- Weighted Round Robin : 각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분하는 방식
    - 서버의 트래픽 처리 능력이 다를 경우 사용된다.
    - A - 5 가중치 / B - 2 가중치를 가지고 있을 경우 A 서버에 5개의 요청을 우선 전달한 후 B 서버에 2개의 요청을 전달한다.
- IP Hash : 클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식
    - 사용자의 IP를 해싱해 로드를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장한다.
- Least Connection : 요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트래픽을 배분하는 방식
    - 서버에 분산된 트래픽들이 일정하지 않은 경우에 적합하다.
    - 자주 세션이 길어지는 경우에 적합하다.
- Least Response Time : 서버의 현재 연결 상태와 응답 시간을 모두 고려해 트래픽을 배분하는 방식이다.
    - 가장 적은 연결 상태와 가장 짧은 응답 시간을 보이는 서버에 우선적으로 요청을 전달한다.

+) OSI 7계층에서의 로드 밸런싱에는 L4 밸런싱 / L7 밸런싱이 존재한다.

## 로드 밸런싱의 문제점

로드 밸런싱이 필요한 대규모 트래픽이 발생하는 서비스에서는 **세션 관리에 문제**가 생길 수 있다.

→ 클라이언트의 연결 정보를 저장하는 세션이 로드밸런싱을 통해 하나의 서버 장비에 저장이 되는 경우,**추후 다른 서버로 접속하게 되면, 해당 클라이언트의 세션이 유지되지 않는다.**

## 해결방법 - 세션 고정(Sticky Session)

클라이언트의 첫 요청에 대해 응답을 준 서버에 **클라이언트의 요청 처리를 고정**시키는 방법이다.

→ Cookie나 IP Tracking 방식을 통해 구현한다.

### 문제점

- 특정 서버에 과부하가 발생할 수 있다.
- 과부하가 발생한 서버가 다운되면 그 서버의 세션이 전부 사라진다.

## 해결 방법 - 세션 클러스터링(Session Clustering)d

여러 WAS의 세션을 하나로 묶어 **하나의 세션으로 관리**하는 것

→ Redis를 사용하여 세션 서버를 따로 두고 세션을 일치시키는 방법을 사용할 수도 있다.


> ⭐ 
> - **Web Server (웹 서버)** : HTTP 요청을 받아 **Static contents**를 제공하는 서버, 프로그램
> - **WAS (Web Application Server) 웹 어플리케이션 서버** : 다양한 서버 내 알고리즘, 비즈니스 로직, DB 조회 등 클라이언트 요청에 따라 **Dynamic contents**를 제공하는 서버, 프로그램


## 클러스터링

여러 대의 컴퓨터를 병렬로 연결해 **하나의 컴퓨터처럼 사용**하게 해주는 방식

- 이중화 : 운영 중인 서비스의 안정성을 위해 각종 자원을 이중 또는 그 이상으로 구성하는 것
- Fail Over : 장애가 일어난 Active 서버를 내리고 대기하고 있던 StandBy 서버를 올리는 것
    - fail over 발생 시 active 서버에 할당한 가상 ip주소를 제거하고 **StandBy 서버에 해당 주소를 재할당**하기 때문에, **클라이언트는 동일한 IP주소로 그대로 접속이 가능**하다.

## 로드 밸런싱과 클러스트링

- **공통점**
    - 로드밸런싱과 클러스터링 모두 scale out 방식이다.

- 차이점

| 항목 | 로드 밸런싱 | 클러스터링 |
| --- | --- | --- |
| 의미 | 여러 대의 서버에 이 패킷을 분산시켜주는 것을 목표로 한다. | 한 서비스를 제공하는 여러 개의 서버를 하나로 묶어 성능을 높여 많은 패킷을 감당하는 형식 |
| 세션 공유 | 세션 공유가 되지 않기 때문에 클라이언트의 접속 정보를 저장한 서버 이외에 다른 서버에 접속 시 세션이 끊긴다. | 각 서버 간의 상태를 공유하기 떄문에 클러스터링된 서버 중 하나가 죽더라도 기존의 세션 연결이 끊기지 않고 다른 서버로 failover된다. |


> ⭐ <br>- **scale-up** : 하드웨어의 성능을 높여 서버가 빠르게 동작하도록 하는 방식 <br>- **scale-out** : 여러 대의 서버가 나눠서 동작하도록 하여 성능을 개선하는 방식

