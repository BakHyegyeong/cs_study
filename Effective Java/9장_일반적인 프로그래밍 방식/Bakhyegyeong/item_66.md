# 아이템 66 : 네이티브 메서드는 신중히 사용하라

# 네이티브 메서드

C/C++ 같은 네이티브 프로그래밍 언어로 작성한 메서드

## 자바 네이티브 인터페이스

자바 프로그램이 네이티브 메서드를 호출하는 기술

1. 자바 네이티브 인터페이스 작성
    
    ```java
    public class ExampleJNI {
        
        static {
           System.loadLibrary("EdenJNI");
        }
    
       private native int getNumber();
    
       public static void main(String[] args) {
          ExampleJNI jni = new ExampleJNI();
          System.out.println(jni.getNumber());
       }
    }
    ```
    

1. 터미널에서 javah 명령어로 헤더 파일(C or C++ 을 구현할 수 있는 파일) 생성
2. 네이티브 메서드 구현
3. 위의 코드를 공유 라이브러리 등록

## 네이티브 메서드 쓰임

1. 레지스트리 같은 플랫폼 특화 기능
    
    → 자바 역시 9 이상부터는 OS 프로세스에 접근할 수 있는 API를 제공한다.
    
2. 네이티브 코드로 작성된 기존 라이브러리 사용
    
    → 대체할 만한 자바 라이브러리가 없을 경우
    
3. 성능 개선의 목적으로 성능에 영향을 주는 부분만 사용
    
    → JVM 역시 발전했기 때문에 **성능 개선의 목적으로는 네이티브 메서드를 사용하지 않는 것이 권장**된다.
    

## 네이티브 메서드 단점

1. 네이티브 언어는 메모리 훼손 오류로부터 안전하지 않다.
    
    → 가비지 컬렉터가 네이티브 메모리는 자동 회수하지 못하고, 심지어 추적조차 할 수 없다.
    
2. 자바보다 플랫폼을 많이 타서 이식성이 낮다.
3. 성능, 비용, 디버깅 측면에서 모두 좋지 않다.
    - 자바 코드와 네티이브 코드의 경계를 넘나들 때마다 비용(접착 코드)이 추가된다.
    - 가독성도 떨어지고 다루기 어렵다.
    - 접착 코드 : 프로그램의 요구사항 구현에는 기여하지 않지만, 본래 호환성이 없는 부분끼리 결합하기 위해 작동하는 코드

## 핵심 정리

- 네이티브 메서드가 성능을 개선해주는 일은 많지 않기 때문에 사용하려거든 신중히 생각하라.
- 저수준 자원이나 네이티브 라이브러리를 사용해야만 해서 어쩔 수 없더라도 네이티브 코드는 최소한만 사용하고 철저히 테스트하자.